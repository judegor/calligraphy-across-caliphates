<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map – Calligraphy Across the Caliphates</title>
  <link rel="icon" type="image/png" href="/calligraphy-across-caliphates/images/favicon.png" />

  
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet" />

  
  <link rel="stylesheet" href="/calligraphy-across-caliphates/css/custom.css" />

  
</head>
<body>
  <header class="header-wrapper">
  <h1 class="project-title">Calligraphy Across the Caliphates</h1>
  <img
    src="/calligraphy-across-caliphates/images/project_logo.png"
    alt="Project Logo"
    class="project-logo"
  >

  <nav class="nav-menu">
  <a href="https://judegor.github.io/calligraphy-across-caliphates/project"    class="nav-link">Project</a>
  <a href="https://judegor.github.io/calligraphy-across-caliphates/timeline"   class="nav-link">Timeline</a>
  <a href="https://judegor.github.io/calligraphy-across-caliphates/map"        class="nav-link">Map</a>
  <a href="https://judegor.github.io/calligraphy-across-caliphates/references" class="nav-link">References</a>
  <a href="https://judegor.github.io/calligraphy-across-caliphates/team"       class="nav-link">Team</a>
  <a href="https://judegor.github.io/calligraphy-across-caliphates/"           class="nav-link" title="Home">
    <img src="/calligraphy-across-caliphates/images/home-icon.svg" alt="Home" class="home-icon">
  </a>
</nav>

  <div class="curve"></div>
</header>


  
<main>
  <!-- force rebuild -->

  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" />
<script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>


<style>
  body {
    background-repeat: repeat;
    background-size: cover;
    background-blend-mode: multiply;
    margin: 0;
    padding: 0;
  }

  main .Content {
    margin-top: 40px;
  }

  #map-container {
    position: relative;
    width: 96%;
    margin: 40px auto 60px auto;
    border-radius: 12px;
    border: 2px solid rgba(210, 180, 140, 0.6);
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.25);
    overflow: hidden;
  }
#map-title {
  background: url('/calligraphy-across-caliphates/images/pergament.jpg') repeat;
  padding: 30px 0 20px;
  text-align: center;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  border-bottom: 1px solid rgba(170, 140, 110, 0.4);
  box-shadow: inset 0 -6px 10px rgba(0,0,0,0.05);
  margin-bottom: 0;
}

.title-arabic {
  font-size: 22px;
  color: #a88a64;
  direction: rtl;
  margin-bottom: 8px;
  font-weight: 500;
  letter-spacing: 0.5px;
  opacity: 0.8;
}

.title-text {
  font-size: 32px;
  color: #2e1d12;
  font-weight: bold;
  line-height: 1.4;
}

.title-divider {
  margin: 16px auto 0 auto;
  width: 160px;
  height: 1px;
  background-image: linear-gradient(to right, transparent, #a88a64 30%, #a88a64 70%, transparent);
  opacity: 0.5;
}

#map {
  position: relative;
  height: 600px;
  opacity: 0;
  transition: opacity 1s ease-in;
  border-radius: 12px;
  z-index: 0;
}
  #map.loaded {
    opacity: 1;
  }

  #map-legend {
    position: absolute;
    bottom: 50px;
    right: 20px;
     background: rgba(255, 248, 240, 0.95);
  border: 1px solid #ccbba0;
  border-radius: 12px;
  padding: 12px 16px;
  font-family: 'Amiri', serif;
  font-size: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.07);
}
.leaflet-control-attribution {
  font-family: 'Amiri', serif !important;
  font-size: 14px !important;
  color: #5c4a36 !important;
  background: rgba(245, 235, 220, 0.85) !important;
  border-radius: 8px !important;
  padding: 6px 10px !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  border: 1px dashed #bba88a;
  direction: rtl;
  text-align: right;
}

  .dot {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 6px;
  }

#filters {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 1001;
  background: rgba(255, 248, 240, 0.95);
  border: 1px solid #ccbba0;
  border-radius: 12px;
  padding: 12px 16px;
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: #3a2d23;
  box-shadow: 0 4px 10px rgba(0,0,0,0.07);
}

  #filters label {
    display: block;
    margin-bottom: 4px;
    cursor: pointer;
  }

  .leaflet-popup-content-wrapper {
    background: #f5ede2 !important;
    border: 1px solid #cdbba7;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    font-family: 'Amiri', serif;
    color: #3a2d23;
  }

  .leaflet-popup-tip {
    background: #f5ede2 !important;
  }

  .leaflet-popup-content {
    margin: 8px 12px;
    font-size: 15px;
    line-height: 1.5;
  }

  .leaflet-popup-content b {
    font-size: 17px;
    color: #2e1d12;
  }

  .leaflet-popup-content i {
    color: #6e5845;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

#reset-button {
  position: absolute;
  top: 20px;
  right: 165px;
  z-index: 1001;
background: linear-gradient(#f5ede2, #e4d4c2);
  border: 1px solid #bba88a;
  border-radius: 50px;
  padding: 6px 16px;
  font-family: 'Amiri', serif;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  color: #3a2d23;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
  transition: background 0.3s ease;
  }
  #reset-button:hover {
    background: rgba(245, 235, 220, 1);
  }

  .leaflet-control-attribution {
    font-family: 'Amiri', serif !important;
    font-size: 12px !important;
    color: #444 !important;
    background: rgba(245, 235, 220, 0.7) !important;
    border-radius: 4px !important;
    padding: 2px 6px !important;
    box-shadow: none !important;
  }

  .period-btn {
    margin: 4px;
    padding: 6px 12px;
    background: #f5ede2;
    border: 1px solid #bba88a;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    color: #3a2d23;
  }
  .period-btn:hover {
    background: #e5dbc9;
  }
  .period-btn.active {
    background: #d4c4af;
    font-weight: bold;
  }

</style>

<div id="map-container">
<div id="map-title">
  <div class="title-arabic">الخط عبر الخلافات</div>
  <div class="title-text">Visualizing Calligraphy Across Regions</div>
  <div class="title-divider"></div>
</div>

  
  <div id="map">
    <div id="reset-button">↺ Reset View</div>
    <div id="filters"></div>
  </div>
  
  <div id="map-legend"></div>
</div>


<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<script>
const initialView = {
  center: [31.5, 30],
  zoom: 4
};

const map = L.map('map').setView(initialView.center, initialView.zoom);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '<span style="font-family:Amiri;">الخريطة © OpenStreetMap</span>',
  zIndex: 1
}).addTo(map);

const papyrus = L.imageOverlay(
  '\/calligraphy-across-caliphates\/images\/papyrus-texture.jpg',
  [[-90, -180], [90, 180]],
  {
    opacity: 0.4,
    interactive: false,
    zIndex: 2
  }
).addTo(map);

window.addEventListener('load', () => {
  document.getElementById('map').classList.add('loaded');
});

const scriptGroups = {};
const periodGroups = {};
let resetTimeout = null;

fetch('\/calligraphy-across-caliphates\/data\/mapdata.json')
  .then(response => response.json())
  .then(data => {
    const legend = document.getElementById('map-legend');
    const filters = document.getElementById('filters');

    data.forEach(scriptEntry => {
      const { script, description, color, locations } = scriptEntry;

      const legendItem = document.createElement('div');
      legendItem.innerHTML = `<span class="dot" style="background:${color};"></span> ${script}`;
      legend.appendChild(legendItem);

      const checkbox = document.createElement('label');
      checkbox.innerHTML = `
        <input type="checkbox" value="${script}" checked onchange="toggleScript('${script}')"> ${script}
      `;
      filters.appendChild(checkbox);

      scriptGroups[script] = [];

      locations.forEach(loc => {
        if (loc.lat && loc.lng) {
          const marker = L.circleMarker([loc.lat, loc.lng], {
            radius: 8,
            fillColor: color,
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          }).addTo(map);

          marker.bindPopup(`
            <div style="font-family: 'Amiri', serif; font-size: 16px; line-height: 1.4; color: #3a2d23;">
              <b style="font-size: 18px;">${script}</b><br>
              <span style="color: #666;">${loc.name}</span><br>
              <i>${description}</i>
            </div>
          `);

          marker.on('click', () => {
            map.setView(marker.getLatLng(), 7, { animate: true });
            if (resetTimeout) clearTimeout(resetTimeout);
            resetTimeout = setTimeout(() => {
              map.setView(initialView.center, initialView.zoom, { animate: true });
            }, 6000);
          });

          scriptGroups[script].push(marker);

          const period = loc.period || 'unknown';
          if (!periodGroups[period]) {
            periodGroups[period] = [];
          }
          periodGroups[period].push(marker);
        }
      });
    });
  })
  .catch(error => {
    console.error('Ошибка при загрузке mapdata.json:', error);
  });

function toggleScript(script) {
  const checkbox = document.querySelector(`#filters input[value="${script}"]`);
  const visible = checkbox?.checked ?? true;
  scriptGroups[script].forEach(marker => {
    if (visible) {
      marker.addTo(map);
    } else {
      map.removeLayer(marker);
    }
  });
}

document.getElementById('reset-button').addEventListener('click', () => {
  if (resetTimeout) clearTimeout(resetTimeout);
  map.setView(initialView.center, initialView.zoom, { animate: true });
});

</script>

</main>


  <footer>
    <p>&copy; 2025 Calligraphy Across the Caliphates</p>
  </footer>
</body>
</html>
